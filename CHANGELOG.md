# 변경 로그 (Changelog)

이 프로젝트의 모든 주요 변경 사항은 이 파일에 기록됩니다.
이 형식은 [Keep a Changelog](https://keepachangelog.com/en/1.0.0/)을 따르며, 이 프로젝트는 [유의적 버전](https://semver.org/spec/v2.0.0.html)을 준수합니다.

## [v1.2.1] - 2025-07-13
### Fixed
- **서버 런타임 오류 수정**: `services/portfolio_service.py` 파일에서 데이터베이스 객체(`db`)를 import하지 않아 발생하던 `NameError`를 해결했습니다. 이로 인해 대시보드 및 배당 분석 페이지 접근 시 발생하던 500 에러가 수정되었습니다.

---

## [v1.2.0] - 2025-07-13
### Added
- **'지급 완료' vs '예정' 배당 분리 기능**: 배당 분석 페이지의 월별 차트를 개선하여, 과거 월의 '지급 완료' 배당(DB 기록 기반)과 미래 월의 '지급 예정' 배당(API 공시 기반)을 시각적으로 분리하여 표시합니다. 이를 통해 사용자는 배당금 현황을 더 명확하고 정확하게 파악할 수 있습니다.
- **상세 정보에 배당 상태 표시**: 월별 차트 클릭 시 나타나는 상세 정보 목록에 각 배당금의 상태('지급 완료' 또는 '예정')를 배지로 표시하는 기능을 추가했습니다.

### Changed
- **월별 배당 차트 시각화 개선**: 기존의 단순 막대그래프를 스택(Stacked) 막대그래프로 변경하여, '지급 완료'와 '예정' 배당을 서로 다른 색상으로 누적하여 보여주도록 개선했습니다.
- **백엔드 로직 고도화**: 월별 배당 데이터를 집계하는 서비스 로직(`services.py`)을 재설계하여, DB와 API라는 두 가지 다른 데이터 소스를 통합하고 분리된(differentiated) 데이터를 생성하도록 변경했습니다.

---

## [v1.1.1] - 2025-07-13
### Fixed
- **대시보드 차트 렌더링 오류 수정**: 대시보드 페이지(`dashboard.html`)의 JavaScript에 존재하던 중복되고 잘못된 차트 초기화 코드를 제거하여, 월별 배당금 및 섹터 비중 차트가 정상적으로 표시되도록 수정했습니다.
- **UI 일관성 강화**: 대시보드의 월별 배당금 차트 스타일을 배당금 분석 페이지와 통일하여 시각적 일관성을 확보했습니다.
- **백엔드 데이터 구조 개선**: 대시보드에 전달되는 월별 배당금 데이터 구조를 최적화하여 템플릿 로직을 간소화했습니다.

---

## [v1.1.0] - 2025-07-13
### Added
- **정확한 배당 지급일 정보 조회**: `Polygon.io` API를 도입하여, 정확한 배당 **지급일(Pay Date)** 정보를 가져오는 기능을 구현했습니다. 이를 통해 사용자는 실제 현금 흐름 기준으로 월별 배당을 분석할 수 있습니다.

### Changed
- **배당 데이터 소스 교체**: 기존의 불안정한 배당 정보 소스를 신뢰도 높은 `Polygon.io` API로 전면 교체했습니다.
- **월별 배당 집계 기준 변경**: API 교체에 따라, 월별 배당금 차트 및 상세 정보의 집계 기준을 '배당락일'에서 실제 현금 흐름을 반영하는 '**배당 지급일**'로 변경했습니다.
- **연간 배당금 계산 로직 개선**: 최근 1년간의 실제 배당금 지급 기록을 합산하여 연간 예상 배당금을 계산하도록 로직을 개선하여 정확도를 높였습니다.

### Fixed
- 이전 버전에서 `Finnhub.io` 유료 플랜 엔드포인트 호출로 인해 발생하던 `403 Forbidden` 에러를 근본적으로 해결했습니다.

---

## [v1.0.0] - 2025-07-13
### Changed
- **[Major] 배당 데이터 소스 교체**: 기존의 `yfinance` API를 `Finnhub.io` API로 전면 교체했습니다. 이를 통해 신뢰할 수 없는 배당 **지급일(Pay Date)** 정보를 정확하게 가져올 수 있게 되어, 애플리케이션의 핵심 기능인 배당 분석의 정확성과 신뢰도를 대폭 향상시켰습니다.
- **월별 배당 집계 기준 변경**: 배당 데이터 소스 교체에 따라, 월별 배당금 차트 및 상세 정보의 집계 기준을 기존의 '배당락일'에서 실제 현금 흐름을 더 잘 나타내는 '**배당 지급일**'로 변경했습니다.
- **백그라운드 배당 내역 동기화 개선**: 배당금 입금 내역을 동기화하는 백그라운드 작업(`tasks.py`) 역시 `Finnhub.io`를 사용하도록 변경하여, 데이터베이스에 정확한 지급일과 배당락일이 모두 기록되도록 개선했습니다.

### Fixed
- **UI 개선**: 모든 페이지 하단 푸터(footer)에 현재 애플리케이션의 버전 번호(예: v1.0.1)가 표시되도록 수정했습니다.

---

## [v0.8.1] - 2025-07-13
### Changed
- **코드 리팩토링**: 배당 월 계산 로직을 서비스 계층에서 유틸리티 함수(`utils.py`)로 이전하고, 관련 데이터(상세 일정, 월 목록)를 하나의 객체로 묶어 반환하도록 구조를 개선했습니다. 이를 통해 코드의 관심사 분리를 강화하고 유지보수성을 향상시켰습니다.

---

## [v0.8.0] - 2025-07-13
### Added
- **월별 배당 상세 정보 강화**: 배당 분석 페이지의 월별 차트 클릭 시 나타나는 상세 정보 뷰에 각 종목의 **배당락일**을 추가하고, 목록을 배당락일 오름차순으로 정렬하는 기능을 추가했습니다. 이를 통해 사용자는 월별 배당 지급 일정을 시간 순서대로 명확하게 파악할 수 있습니다.

### Changed
- **백엔드 데이터 로직 개선**: `utils.py`의 배당 정보 조회 함수를 개선하여, 단순 배당 월이 아닌 상세 배당 지급 일정(날짜, 금액)을 조회하고 캐시하도록 변경했습니다. 서비스 계층은 이 데이터를 활용하여 프론트엔드에 더 풍부한 정보를 제공합니다.

---

## [v0.7.0] - 2025-07-13
### Added
- **종목 프로필 이미지 지연 로딩**: 보유 종목 및 배당금 분석 페이지의 종목 리스트에 프로필 이미지를 표시하는 기능을 추가했습니다. `loading="lazy"` 속성을 적용하여 초기 페이지 로딩 속도를 최적화했습니다.

### Changed
- **이미지 로딩 Fallback 개선**: 종목 프로필 이미지 로드에 실패할 경우, 깨진 아이콘 대신 종목의 첫 글자를 포함한 기본 플레이스홀더 이미지가 표시되도록 `onerror` 핸들러 로직을 개선하여 시각적 안정성을 강화했습니다.
- **코드 리팩토링**: 보유 종목 및 배당금 분석 페이지에서 중복되던 종목 로고 렌더링 로직을 하나의 재사용 가능한 Jinja2 매크로(`macros.html`)로 추출하여 코드 중복을 제거하고 유지보수성을 향상시켰습니다.
---

## [v0.6.2] - 2025-07-13
### Fixed
- **API 호출 오류 수정**: `yfinance` 벌크 API 호출 시 지원되지 않는 `progress` 인수를 사용하여 발생하던 `TypeError`를 수정했습니다.
- **템플릿 렌더링 오류 수정**: 대시보드 템플릿(`dashboard.html`)에서 `title` 블록이 중복 정의되어 발생하던 `TemplateAssertionError`를 수정했습니다.

---

## [v0.6.1] - 2025-07-13
### Changed
- **UI 일관성 강화**: 대시보드의 월별 배당금 차트 스타일(단일 둥근 막대, Y축 제거 등)을 배당금 분석 페이지와 통일하여 시각적 일관성을 확보했습니다.
- **종목 정렬 기준 통일**: 보유 종목 및 배당금 분석 페이지의 종목 리스트를 '현재 평가금액' 기준 내림차순으로 정렬하여, 포트폴리오의 핵심 자산을 쉽게 파악할 수 있도록 개선했습니다.
- **배당금 분석 페이지 UI 개선**: 도넛 차트의 데이터 라벨을 제거하여 더 깔끔하게 보이도록 하고, 마우스 오버 시에만 툴팁으로 상세 정보가 표시되도록 변경했습니다.
- **월별 배당 상세 정보 개선**: 차트에서 특정 월 클릭 시 나타나는 상세 정보에 '보유 수량'과 '1회당 주당 배당금'을 추가하여 데이터의 투명성을 높였습니다.
- **네비게이션 메뉴 명확화**: '예상 배당금' 메뉴를 '배당금 분석'으로 변경하여 실제 페이지의 기능과 일치시켰습니다.
- **API 호출 방식 개선**: 개별 종목 API 호출을 벌크(Bulk) 호출 방식으로 변경하여, `yfinance` API의 Rate Limit 발생 가능성을 크게 줄이고 페이지 로딩 성능을 향상시켰습니다.


### Fixed
- **차트 렌더링 오류 수정**: 월별 배당금 차트의 막대 상단에 표시되는 데이터 라벨이 차트 영역을 벗어나 잘려 보이던 문제를 해결했습니다.
- **대시보드 섹터 차트 오류 수정**: 대시보드의 섹터 비중 차트에서 `[object Object]`로 표시되던 문제를 수정하고, 상세한 종목 정보가 포함된 툴팁 기능이 정상적으로 작동하도록 개선했습니다.
- **종목 프로필 이미지 로딩 오류 수정**: 외부 API에서 로고를 가져오지 못할 경우, 깨진 이미지 대신 기본 플레이스홀더 이미지가 표시되도록 수정했습니다.
- **런타임 에러 수정**: `utils.py`에서 API 실패 시 DB 캐시 객체를 잘못 처리하여 발생하던 `AttributeError` 버그를 수정했습니다. 이제 데이터 타입을 명확히 확인하여 안정적으로 처리합니다.
- **안정성 강화**: 외부 API 호출 실패에 대한 전반적인 예외 처리를 강화하여, API 오류가 발생하더라도 애플리케이션이 중단되지 않도록 개선했습니다.

---

## [v0.6.0] - 2025-07-12
### Changed
- **배당금 페이지 UI/UX 전면 개편**: '예상 배당금' 페이지의 이름과 표현을 '배당금 분석'으로 변경하고, 전체 레이아웃을 사용자 친화적으로 재설계했습니다.
  - 종목별 배당금 리스트를 로고와 함께 표시하여 가독성을 높였습니다.
  - 배당 비중 차트를 원형에서 도넛 형태로 변경했습니다.
  - 월별 배당금 차트를 종목별 누적 막대에서 월별 총합을 보여주는 단순한 형태로 변경하고, Y축 제거 및 막대 스타일을 둥글게 만들어 시각적 부담을 줄였습니다.
- **UI 일관성 강화**: 대시보드의 월별 배당금 차트 스타일(둥근 막대, Y축 제거 등)을 배당금 분석 페이지와 통일하여 시각적 일관성을 확보했습니다.
- **배당금 분석 페이지 UI 개선**: 도넛 차트의 데이터 라벨을 제거하여 더 깔끔하게 보이도록 하고, 마우스 오버 시에만 툴팁으로 상세 정보가 표시되도록 변경했습니다.
- **월별 배당 상세 정보 개선**: 차트에서 특정 월 클릭 시 나타나는 상세 정보에 '보유 수량'과 '1회당 주당 배당금'을 추가하여 데이터의 투명성을 높였습니다.
- **네비게이션 메뉴 명확화**: '예상 배당금' 메뉴를 '배당금 분석'으로 변경하여 실제 페이지의 기능과 일치시켰습니다.

### Added
- **월별 배당금 상세 조회 기능**: 월별 배당금 차트에서 특정 월의 막대를 클릭하면, 해당 월에 배당을 지급하는 종목 리스트와 금액을 상세하게 보여주는 인터랙티브 기능을 추가했습니다.

### Fixed
- **차트 렌더링 오류 수정**: 월별 배당금 차트의 막대 상단에 표시되는 데이터 라벨이 차트 영역을 벗어나 잘려 보이던 문제를 해결했습니다.
  
---

## [v0.5.0] - 2025-07-12
### Changed
- **보유 종목 페이지 UI/UX 개선**: 종목 로고를 표시하고, 평가/투자 정보를 간결한 레이아웃으로 재구성하여 가독성을 향상시켰습니다. 이제 각 종목의 재무 현황을 한눈에 파악하기 용이합니다.

### Added
- **종목 로고 조회 기능**: `stock_api.py`의 프로필 조회 로직에 `logo_url`을 추가하여, `yfinance`에서 제공하는 종목별 로고 이미지를 가져올 수 있도록 기능을 추가했습니다. 로고가 없는 경우 기본 아이콘을 표시하는 폴백 로직도 함께 구현되었습니다.

---

## [v0.4.0] - 2025-07-12
### Changed
- **배당금 계산 로직 개선**: 배당금 지급 자격을 '배당락일(Ex-Dividend Date)' 기준으로 판단하도록 핵심 로직을 변경했습니다. 이제 사용자의 거래 기록을 바탕으로 배당락일 시점의 보유 수량을 정확히 계산하여 배당 내역을 기록합니다.

### Added
- **배당락일 기준 보유 수량 계산 함수**: `tasks.py`에 특정 날짜 기준의 주식 보유량을 계산하는 `get_quantity_on_date` 함수를 추가했습니다.
- `models.py`의 `Dividend` 테이블에 `ex_dividend_date` 컬럼을 추가하여, 배당금 계산 기준일을 명확히 추적할 수 있도록 했습니다.

### Fixed
- 과거 모든 배당금이 보유량과 무관하게 기록되던 문제를 해결하여, 실제 수령할 배당금만 정확히 표시되도록 수정했습니다.

---

## [v0.3.0] - 2025-07-12
### Added
- **서비스 계층 도입**: `services/portfolio_service.py`를 추가하여 포트폴리오 데이터 계산 비즈니스 로직을 중앙화하고 코드 중복을 제거했습니다.
- **파일 기반 캐싱**: 앱 시작 시 SEC에서 가져오는 전체 주식 목록을 `us_stocks.json` 파일에 캐싱하여, 외부 API 장애 시에도 안정적으로 앱이 시작되도록 구현했습니다.

### Changed
- **Redis 캐싱 시스템 강화**: `stock_api.py` 및 `utils.py`의 모든 외부 API(주가, 프로필, 배당) 호출에 Redis 캐시를 적용하여, 반복 조회 시 응답 속도를 극적으로 향상시켰습니다.
- **라우트 로직 단순화**: `routes.py`의 대시보드 및 배당금 관련 라우트가 새로운 서비스 계층을 호출하도록 리팩토링하여, 코드의 가독성과 유지보수성을 높였습니다.

### Fixed
- **성능 병목 해결**: 페이지 로드 시마다 발생하던 과도한 API 호출 문제를 Redis 캐싱 도입으로 해결했습니다.

---

## [v0.2.0] - 2025-07-12
### Added
- **전역 종목 검색 기능**: 네비게이션 바에 미국 주식 전체를 검색할 수 있는 자동완성 검색창을 추가했습니다. (`/api/search-stocks`)
- **종목 상세 페이지**: 검색한 종목의 상세 정보와 6개월 시세 차트를 보여주는 페이지를 추가했습니다. (`/stock/<symbol>`)
- **배당금 차트 데이터 라벨**: 월별 예상 배당금 막대그래프 위에 총액을 숫자로 표시하는 기능을 추가했습니다.
- **실제 배당금 내역 페이지**: `/dividends/history` 페이지를 추가하여 DB에 저장된 실제 배당금 입금 기록을 확인할 수 있도록 했습니다.

### Changed
- **배당금 차트 툴팁 개선**: 배당 비중 파이 차트의 툴팁에 종목명, 금액, 비중(%)이 함께 표시되도록 개선했습니다.
- **대시보드 섹터 그래프 UI 개선**: 트리맵 차트의 폰트 크기를 키우고, 툴팁에 해당 섹터의 상세 종목 리스트와 비중이 표시되도록 기능을 강화했습니다.
- **검색창 UI/UX 개선**: 데스크톱과 모바일 환경 모두에서 다른 UI 요소와 충돌하지 않도록 검색창의 위치와 반응형 동작을 수정했습니다.
- **대시보드 레이아웃 변경**: 주요 자산 정보를 개별 위젯 카드 형태로 분리하여 가독성을 높였습니다.

### Fixed
- **SCHD 등 ETF 배당금 누락 문제**: `yfinance` 데이터 조회 시 `yield` 값을 활용하는 폴백 로직을 추가하여, `dividendRate`가 없는 ETF의 배당 정보도 정확히 계산하도록 수정했습니다.
- **TLT 12월 특별배당 계산 오류**: 연간 실제 배당 횟수를 기준으로 월별 배당금을 계산하도록 로직을 변경하여, 한 달에 여러 번 배당하는 경우도 정확히 반영하도록 수정했습니다.
- **Jinja2 템플릿 필터 오류**: `dividends.html`에서 존재하지 않는 필터를 호출하던 오류를 수정했습니다. 복잡한 데이터 처리를 템플릿 대신 백엔드 라우트에서 수행하도록 로직을 변경하여 근본적으로 해결했습니다.
- **템플릿 주석 노출 문제**: 사용자 화면에 노출되던 파이썬 스타일 주석(`#`)을 템플릿 엔진이 처리하는 `{# ... #}` 주석으로 변경했습니다.

---

## [v0.1.0] - 2025-07-08
### Added
- **프로젝트 초기 설정**: Flask, SQLAlchemy, RQ 등 기본 구조 설정.
- **사용자 인증**: 회원가입, 로그인, 로그아웃 기능 구현.
- **거래 내역 기반 자산 관리**:
  - 매수/매도 거래 기록 추가 및 삭제 기능.
  - FIFO(선입선출) 방식에 따른 보유 종목 및 평균 단가 자동 계산 로직 구현.
- **기본 대시보드**: 총 자산, 수익률 등 기본 포트폴리오 요약 정보 표시.
- **기본 배당금 관리**: 예상 배당금 및 배당수익률 계산 기능.
- **프로덕션 배포 설정**: `render.yaml`을 통한 웹/워커/DB/Redis 서비스 배포 구성.
